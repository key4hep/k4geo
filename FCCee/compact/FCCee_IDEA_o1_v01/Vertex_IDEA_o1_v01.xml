<!-- Changes :
   o4_v04 : scaled version of the CLIC VTX Barrel (CLIC_04_v11); distance between sensitive layers in double layers are set to 1*mm and is similar in all 3 layers
-->

<lccdd>

    <info name="FCCee"
        title="FCCee Vertex detector: taken correspoding to CLD: Vertex_o4_v05.xml, but adapted to IDEA vertex detector"
        author="nalipour taken from lcgeo (CLD version), adapted by Armin Ilg (IDEA version)"
        url="no"
        status="development"
        version="1.1">
    <comment>A Vertex Detector for FCCee IDEA detector concept</comment>
  </info>

    <comment>Tracking detectors</comment>
    <detectors>
        <detector name="Vertex" type="DD4hep_SubdetectorAssembly" vis="VXDVis">
            <shape type="BooleanShape" operation="Subtraction" material="Air">
                <shape type="BooleanShape" operation="Subtraction">
                    <shape type="Tube" rmin="Inner_Vertex_inner_radius-Inner_Vertex_inner_radius_clearance" rmax="Outer_Vertex_outer_radius" dz="Outer_Vertex_half_length"/>
                    <shape type="Cone" rmin1="0" rmax1="VertexClearanceTheta*Outer_Vertex_half_length-env_safety" rmin2="0" rmax2="Inner_Vertex_inner_radius-Inner_Vertex_inner_radius_clearance" z="((Outer_Vertex_half_length-CentralBeamPipe_zmax)/2+env_safety)"/>
                    <position x="0" y="0" z="-(CentralBeamPipe_zmax+(Outer_Vertex_half_length-CentralBeamPipe_zmax)/2+env_safety)" />
                </shape>
                
                <shape type="Cone" rmin1="0" rmax1="Inner_Vertex_inner_radius-Inner_Vertex_inner_radius_clearance" rmin2="0" rmax2="VertexClearanceTheta*Outer_Vertex_half_length-env_safety" z="(Outer_Vertex_half_length-CentralBeamPipe_zmax)/2+env_safety"/>
                <position x="0" y="0" z="CentralBeamPipe_zmax+(Outer_Vertex_half_length-CentralBeamPipe_zmax)/2+env_safety" />
            </shape>
            <comment>Vertex Assembly</comment>
            <composite name="VertexBarrel"/>
            <composite name="VertexOuterBarrel"/>
            <composite name="VertexEndcap"/>
            <!-- <composite name="VertexVerticalCable"/> -->
        </detector>
    </detectors>
    
    <display>
        <vis name="SiVertexSensitiveVis" alpha="1.0" r="0.5" g="0.5"  b="0"     showDaughters="true"  visible="true"/>
        <vis name="SiVertexPeripheryVis" alpha="1.0" r="0.6" g="0.5"  b="0"     showDaughters="true"  visible="true"/>
        <vis name="SiVertexCableVis"     alpha="1.0" r="0.85" g="0.53"    b="0.4"       showDaughters="true"  visible="true"/>
        <vis name="CarbonFiberVis"       alpha="1.0" r="0.5" g="0.5"    b="0.5"       showDaughters="true"  visible="true"/>
        <vis name="SiVertexAir"          alpha="1.0" r="0" g="0"    b="0"       showDaughters="false"  visible="false"/>
        <vis name="SiVertexEndcapSensitiveVis" alpha="1.0" r="0.5" g="0.5"  b="0"     showDaughters="true"  visible="true"/>
        <vis name="SiVertexEndcapPeripheryVis" alpha="1.0" r="0.6" g="0.5"  b="0"     showDaughters="true"  visible="true"/>
    </display>
     
    <define>

        <!-- Sensor characteristics -->

        <!-- Inner barrel -->
            <!-- Let's take the ARCADIA chip! -->
            <constant name="inner_z" value="1.6*cm"/> <!-- Chip length, use modified ARCADIA with length of 1.6cm instead of 2.56cm-->       
            <constant name="inner_rphi_sensitive" value="6.4*mm"/> <!-- Chip length: Sensitive-->
            <constant name="inner_rphi_periphery" value="2*mm"/> <!-- Chip length: Periphery-->
            <constant name="inner_rphi" value="inner_rphi_sensitive+inner_rphi_periphery"/> <!-- Chip length: Sensitive-->
    
            <!-- Module with two ARCADIA chips -->
            <constant name="inner_mod_z" value="inner_z*2"/> 
            <constant name="inner_mod_rphi_sensitive" value="inner_rphi_sensitive"/> 
            <constant name="inner_mod_rphi_periphery" value="inner_rphi_periphery"/>
            <constant name="inner_mod_rphi" value="inner_rphi"/>

        <!-- Outer barrel -->
            <!-- Outer vertex sensor (ATLASPix3-like) -->
            <constant name="outer_z_sensitive" value="19.8*mm"/> <!-- Chip length in z: Sensitive -->
            <constant name="outer_z_periphery" value="0.4*mm"/> <!-- Chip length in z: Periphery -->
            <constant name="outer_z" value="outer_z_sensitive+outer_z_periphery"/> <!-- Chip length in z: Total -->
            <constant name="outer_rphi_sensitive" value="18.6*mm"/> <!-- Chip length in r-phi: Sensitive-->
            <constant name="outer_rphi_periphery" value="2.4*mm"/> <!-- Chip length in r-phi: Periphery-->
            <constant name="outer_rphi" value="outer_rphi_sensitive+outer_rphi_periphery"/> <!-- Chip length in r-phi: Total -->
            <constant name="outer_rphi_sens_spacing" value="2*mm"/> <!-- Distance between individual readout chips in rphi -->
            <constant name="outer_z_sens_spacing" value="2*mm"/> <!-- Distance between individual readout chips in rphi -->

    
            <!-- Module with four ATLASPix3-like chips -->
            <constant name="outer_mod_z_sensitive" value="outer_z_sensitive*2"/>
            <constant name="outer_mod_z_periphery" value="outer_z_periphery*2"/>
            <constant name="outer_mod_z" value="outer_mod_z_sensitive+outer_mod_z_periphery"/>
    
            <constant name="outer_mod_rphi_sensitive" value="outer_rphi_sensitive*2"/>
            <constant name="outer_mod_rphi_periphery" value="outer_rphi_periphery*2"/>
            <constant name="outer_mod_rphi" value="outer_mod_rphi_sensitive+outer_mod_rphi_periphery"/>
        
        <!-- Vertex inner barrel -->
            <constant name="VertexBarrel_Layer1_Staves" value="14"/>
            <constant name="VertexBarrel_Layer2_Staves" value="23"/>
            <constant name="VertexBarrel_Layer3_Staves" value="18"/>
            
            <constant name="VertexBarrel_Layer1_nModules" value="6"/>
            <constant name="VertexBarrel_Layer2_nModules" value="10"/>
            <constant name="VertexBarrel_Layer3_nModules" value="16"/>
    
            <constant name="VertexBarrel_mod_z_spacing" value="0.2*mm"/>
    
            <constant name="VertexBarrel_z1" value="(VertexBarrel_Layer1_nModules*inner_mod_z+(VertexBarrel_Layer1_nModules-1)*VertexBarrel_mod_z_spacing)/2."/>
            <constant name="VertexBarrel_z2" value="(VertexBarrel_Layer2_nModules*inner_mod_z+(VertexBarrel_Layer2_nModules-1)*VertexBarrel_mod_z_spacing)/2."/>
            <constant name="VertexBarrel_z3" value="(VertexBarrel_Layer3_nModules*inner_mod_z+(VertexBarrel_Layer3_nModules-1)*VertexBarrel_mod_z_spacing)/2."/>        
        	<constant name="VertexBarrel_r1" value="Inner_Vertex_inner_radius"/> 
            <constant name="VertexBarrel_r2" value="2.27*cm"/>
            <constant name="VertexBarrel_r3" value="3.305*cm"/>
    
            <constant name="VertexBarrel_Sensitive_Thickness"   value="50e-03*mm"/>
        	<constant name="VertexBarrel_Support_Thickness"     value="200e-03*mm"/> <!-- +50% more material budget as in CLIC VTX -->
    
            <constant name="VertexBarrel_Layer3_overlap" value="0.4*mm"/>        
            <constant name="VertexBarrel_Layer3_offset_r" value="0.695*mm"/>
            
            <constant name="VertexBarrel_Layer1_offset" value="2.50*mm"/>
            <constant name="VertexBarrel_Layer2_offset" value="2.50*mm"/>
            <constant name="VertexBarrel_Layer3_offset" value="2.00*mm"/>
            
        <!-- Vertex endcap -->
            <constant name="VertexEndcap_rmax1" value="247.644*mm"/>
            <constant name="VertexEndcap_rmax2" value="289.595*mm"/>
            <constant name="VertexEndcap_rmax3" value="289.595*mm"/>
            <constant name="VertexEndcap_rmax" value="VertexEndcap_rmax3"/>        
            <constant name="VertexEndcap_z1" value="285*mm"/>
            <constant name="VertexEndcap_z2" value="620*mm"/>
            <constant name="VertexEndcap_z3" value="930*mm"/>
    	    <constant name="VertexEndcap_rmin1" value="35.64*mm"/>
            <constant name="VertexEndcap_rmin2" value="76.995*mm"/>
            <constant name="VertexEndcap_rmin3" value="105.895*mm"/>
            <constant name="VertexEndcap_dr1" value="0.92*mm"/>  <!-- Alternating difference in radius from one petal to the next -->
            <constant name="VertexEndcap_dr2" value="(153.99*mm-152.30*mm)/2."/>
            <constant name="VertexEndcap_dr3" value="0.0*mm"/>  <!-- Alternating difference in radius from one petal to the next -->
            <constant name="VertexEndcap_phi1A" value="0.0*rad"/>
            <constant name="VertexEndcap_phi1B" value="0.7853981634*rad"/> <!-- face B of first disk is offset by 45 degrees-->
            <constant name="VertexEndcap_zoffset_stave" value="6.020*mm"/>
            <constant name="VertexEndcap_zoffset_face" value="19.1412*mm"/> <!-- face B has different position in z than face A-->
            <constant name="VertexEndcap_stave_dz" value="5.0*mm"/> <!-- Distance between front and back of stave (inner empty space) -->

            <constant name="VertexEndcapModuleThickness" value="1.22*mm"/>
            <constant name="VertexEndcapModOverlap" value="-13.0*mm"/>
            <constant name="VertexEndcap_rModOverlap" value="-6.5*mm"/>

            <constant name="VertexEndcap_Sensitive_Thickness"   value="5.000000000e-02*mm"/>

        <!-- Vertex outer barrel -->
            <constant name="VertexOuterBarrel_Staves1" value="24"/>
            <constant name="VertexOuterBarrel_Staves2" value="48"/>
            <constant name="VertexOuterBarrel_nModules1" value="8"/>
            <constant name="VertexOuterBarrel_nModules2" value="16"/>
            <constant name="VertexOuterBarrel_mod_z_spacing" value="0.2*mm"/>
            <constant name="VertexOuterBarrel_mod_rphi_spacing" value="0.2*mm"/>
    
            <constant name="VertexOuterBarrel_z1" value="(VertexOuterBarrel_nModules1*outer_mod_z+(VertexOuterBarrel_nModules1-1)*VertexOuterBarrel_mod_z_spacing)/2."/>
            <constant name="VertexOuterBarrel_z2" value="(VertexOuterBarrel_nModules2*outer_mod_z+(VertexOuterBarrel_nModules2-1)*VertexOuterBarrel_mod_z_spacing)/2."/>
            <constant name="VertexOuterBarrel_r1" value="150*mm"/>
            <constant name="VertexOuterBarrel_r2" value="315*mm"/>
<!--            <constant name="VertexOuterBarrel_tilt" value="0.06754*rad"/>   3.87 deg in rad -->
            <constant name="VertexOuterBarrel_tilt" value="0.0*rad"/>   <!-- 3.87 deg in rad -->

            <!--            <constant name="VertexOuterBarrel_tilt" value="0.0*rad"/>  -->
            <constant name="VertexOuterBarrel_Sensitive_Thickness"              value="5.000000000e-02*mm"/>
            <constant name="VertexOuterBarrel_Support_Thickness_Fleece"         value="20.000000000e-03*mm"/>
            <constant name="VertexOuterBarrel_Support_Thickness_CarbonFiber"    value="120.000000000e-03*mm"/>
            <constant name="VertexOuterBarrel_Support_Thickness_PaperGraphite"  value="25.000000000e-03*mm"/>
            <constant name="VertexOuterBarrel_Support_Thickness"                value="2.0*VertexOuterBarrel_Support_Thickness_Fleece+VertexOuterBarrel_Support_Thickness_CarbonFiber+VertexOuterBarrel_Support_Thickness_PaperGraphite"/>
            <constant name="VertexEndcap_Support_Thickness"                     value="VertexOuterBarrel_Support_Thickness_Fleece+VertexOuterBarrel_Support_Thickness_CarbonFiber+VertexOuterBarrel_Support_Thickness_PaperGraphite"/>

            <constant name="VertexOuterBarrel_rphi_sensitive" value="outer_mod_rphi_sensitive"/>
    
            <constant name="VertexOuterBarrel_rphi_periphery" value="outer_mod_rphi_periphery"/>
    
            <constant name="VertexOuterBarrel_rphi" value="VertexOuterBarrel_rphi_sensitive+VertexOuterBarrel_rphi_periphery"/>
    
            <constant name="VertexOuterBarrel_offset1" value="20.0*mm"/>
            <constant name="VertexOuterBarrel_offset2" value="35.0*mm"/>
    


        <!-- Flex for vertex readout, assume 100 µm total thickness, with two 18 µm copper layers and the rest kapton-->
            <constant name="inner_flex_width" value="1.8*mm"/>
            <constant name="inner_flex_offset" value="inner_rphi/2.-inner_flex_width/2.-0.25*mm"/>
            <constant name="FlexCopperThicknessInner" value="0.036*mm"/>
            <constant name="FlexKaptonThicknessInner" value="0.064*mm"/>

        <!-- Flex for vertex endcap readout, scaled up from above to get to a total of 688 µm -->
            <constant name="VertexEndcap_flex_width" value="16.2*mm"/>
            <constant name="VertexOuterBarrel_flex_width" value="VertexEndcap_flex_width"/>
            <constant name="outer_flex_thickness" value="0.6688*mm"/>
            <constant name="FlexCopperThicknessEndcap" value="0.24*mm"/> <!-- ~36% of total thickness (outer_flex_thickness) -->
            <constant name="FlexKaptonThicknessEndcap" value="outer_flex_thickness-FlexCopperThicknessEndcap"/>

        <!-- Flex for vertex outer barrel readout, scaled up from above to get to a total of 688 µm -->
            <constant name="FlexCopperThicknessOuter" value="0.24*mm"/> <!-- ~36% of total thickness (outer_flex_thickness) -->
            <constant name="FlexKaptonThicknessOuter" value="outer_flex_thickness-FlexCopperThicknessOuter"/>
    </define>        


    <!--  Definition of the readout segmentation/definition  -->
    <readouts>
        <readout name="VertexBarrelCollection">
            <id>${GlobalTrackerReadoutID}</id>
        </readout>
        <readout name="VertexOuterBarrelCollection">
            <id>${GlobalTrackerReadoutID}</id>
        </readout>       
        <readout name="VertexEndcapCollection">
            <id>${GlobalTrackerReadoutID}</id>
        </readout>
    </readouts>

    <!-- Vertex inner barrel -->
    <detectors>
        <detector name="VertexBarrel" type="VertexBarrel_IDEA_o1_v01" vis="VXDVis" id="DetID_VXD_Barrel" readout="VertexBarrelCollection"  region="VertexBarrelRegion">

            <type_flags type=" DetType_TRACKER + DetType_PIXEL + DetType_VERTEX + DetType_BARREL"/>

            <layer nLadders="VertexBarrel_Layer1_Staves" phi0="0" phi_tilt="0.0" id="0">
                <sensitive distance="VertexBarrel_r1" thickness="VertexBarrel_Sensitive_Thickness" width="inner_mod_rphi_sensitive" length="VertexBarrel_z1" offset="VertexBarrel_Layer1_offset-inner_mod_rphi_periphery/2." material="Silicon" vis="SiVertexSensitiveVis" nModules="VertexBarrel_Layer1_nModules" dz="VertexBarrel_mod_z_spacing" z_length="inner_mod_z"/>

                <ladder distance="VertexBarrel_r1+VertexBarrel_Sensitive_Thickness" width="inner_mod_rphi" length="VertexBarrel_z1" offset="VertexBarrel_Layer1_offset" material="CarbonFiber"  vis="CarbonFiberVis">
                    <support thickness="VertexBarrel_Support_Thickness" width="inner_mod_rphi" length="VertexBarrel_z1" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/>
                </ladder>
                <module_envelope width="inner_mod_rphi_periphery" length="0.0*mm" type="1" vis="SiVertexPeripheryVis"/>

                <readout width="inner_flex_width" length="VertexBarrel_z1" distance="VertexBarrel_r1+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="VertexBarrel_Layer1_offset" vis="SiVertexCableVis">
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z1" distance="VertexBarrel_r1+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z1" distance="VertexBarrel_r1+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner" offset="inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z1" distance="VertexBarrel_r1+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="-inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z1" distance="VertexBarrel_r1+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner" offset="-inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                </readout>
            </layer>

            <layer nLadders="VertexBarrel_Layer2_Staves" phi0="0" phi_tilt="0.0" id="1">
                <sensitive distance="VertexBarrel_r2" thickness="VertexBarrel_Sensitive_Thickness" width="inner_mod_rphi_sensitive" length="VertexBarrel_z2" offset="VertexBarrel_Layer2_offset-inner_mod_rphi_periphery/2.0" material="Silicon" vis="SiVertexSensitiveVis" nModules="VertexBarrel_Layer2_nModules" dz="VertexBarrel_mod_z_spacing" z_length="inner_mod_z"/>
                <module_envelope width="inner_mod_rphi_periphery" length="0.0*mm" type="1" vis="SiVertexPeripheryVis"/>

                <ladder distance="VertexBarrel_r2+VertexBarrel_Sensitive_Thickness" width="inner_mod_rphi" length="VertexBarrel_z2" offset="VertexBarrel_Layer2_offset"    material="CarbonFiber"  vis="CarbonFiberVis">
                    <support thickness="VertexBarrel_Support_Thickness" width="inner_mod_rphi" length="VertexBarrel_z2" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/>
                </ladder>

                <readout width="inner_flex_width" length="VertexBarrel_z2" distance="VertexBarrel_r2+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="VertexBarrel_Layer2_offset" vis="SiVertexCableVis">
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z2" distance="VertexBarrel_r2+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z2" distance="VertexBarrel_r2+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner" offset="inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z2" distance="VertexBarrel_r2+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="-inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z2" distance="VertexBarrel_r2+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner" offset="-inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                </readout>
            </layer>


            <layer nLadders="VertexBarrel_Layer3_Staves/2." phi0="0" phi_tilt="0.0" id="2">
                <sensitive distance="VertexBarrel_r3" thickness="VertexBarrel_Sensitive_Thickness" width="inner_mod_rphi_sensitive" length="VertexBarrel_z3" offset="VertexBarrel_Layer3_offset+inner_mod_rphi_sensitive/2.0" material="Silicon" vis="SiVertexSensitiveVis" nModules="VertexBarrel_Layer3_nModules" dz="VertexBarrel_mod_z_spacing" z_length="inner_mod_z"/>
                <module_envelope width="inner_mod_rphi_periphery" length="0.0*mm" type="1" vis="SiVertexPeripheryVis"/>

                <ladder distance="VertexBarrel_r3+VertexBarrel_Sensitive_Thickness" width="inner_mod_rphi" length="VertexBarrel_z3" offset="VertexBarrel_Layer3_offset+inner_mod_rphi/2"    material="CarbonFiber"  vis="CarbonFiberVis">
                    <support thickness="VertexBarrel_Support_Thickness" width="inner_mod_rphi" length="VertexBarrel_z3" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/>
                </ladder>

                <readout width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="VertexBarrel_Layer3_offset+inner_mod_rphi/2" vis="SiVertexCableVis">
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner" offset="inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="-inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner" offset="-inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                </readout>
            </layer>

            <layer nLadders="VertexBarrel_Layer3_Staves/2." phi0="0" phi_tilt="0.0" id="3">
                <sensitive distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r" thickness="VertexBarrel_Sensitive_Thickness" width="inner_mod_rphi_sensitive" length="VertexBarrel_z3" offset="VertexBarrel_Layer3_offset+VertexBarrel_Layer3_overlap-inner_mod_rphi_sensitive/2.0" material="Silicon" vis="SiVertexSensitiveVis" nModules="VertexBarrel_Layer3_nModules" dz="VertexBarrel_mod_z_spacing" z_length="inner_mod_z"/> <!-- Inverted direction-->
                <module_envelope width="inner_mod_rphi_periphery" length="0.0*mm" type="-1" vis="SiVertexPeripheryVis"/>

                <ladder    distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Sensitive_Thickness" thickness="VertexBarrel_Support_Thickness" width="inner_mod_rphi" length="VertexBarrel_z3" offset="VertexBarrel_Layer3_offset+VertexBarrel_Layer3_overlap-inner_mod_rphi/2.0"    material="CarbonFiber"  vis="CarbonFiberVis">
                    <support thickness="VertexBarrel_Support_Thickness" width="inner_mod_rphi" length="VertexBarrel_z3" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/>
                </ladder>

                <readout width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="VertexBarrel_Layer3_offset+VertexBarrel_Layer3_overlap-inner_mod_rphi/2" vis="SiVertexCableVis">
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner" offset="inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness" offset="-inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner" offset="-inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                </readout>
            </layer>




            <layer nLadders="VertexBarrel_Layer3_Staves/2." phi0="0.3490658504" phi_tilt="0.0" id="4">
                <sensitive distance="VertexBarrel_r3+1.45*mm" thickness="VertexBarrel_Sensitive_Thickness" width="inner_mod_rphi_sensitive" length="VertexBarrel_z3" offset="VertexBarrel_Layer3_offset+inner_mod_rphi_sensitive/2.0" material="Silicon" vis="SiVertexSensitiveVis" nModules="VertexBarrel_Layer3_nModules" dz="VertexBarrel_mod_z_spacing" z_length="inner_mod_z"/>
                <module_envelope width="inner_mod_rphi_periphery" length="0.0*mm" type="1" vis="SiVertexPeripheryVis"/>

                <ladder distance="VertexBarrel_r3+VertexBarrel_Sensitive_Thickness+1.45*mm" thickness="VertexBarrel_Support_Thickness" width="inner_mod_rphi" length="VertexBarrel_z3" offset="VertexBarrel_Layer3_offset+inner_mod_rphi/2"    material="CarbonFiber"  vis="CarbonFiberVis">
                    <support thickness="VertexBarrel_Support_Thickness" width="inner_mod_rphi" length="VertexBarrel_z3" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/>
                </ladder>

                <readout width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+1.45*mm" offset="VertexBarrel_Layer3_offset+inner_mod_rphi/2" vis="SiVertexCableVis">
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+1.45*mm" offset="inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner+1.45*mm" offset="inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+1.45*mm" offset="-inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner+1.45*mm" offset="-inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                </readout>
            </layer>

            <layer nLadders="VertexBarrel_Layer3_Staves/2." phi0="0.3490658504" phi_tilt="0.0" id="5    ">
                <sensitive distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+1.45*mm" thickness="VertexBarrel_Sensitive_Thickness" width="inner_mod_rphi_sensitive" length="VertexBarrel_z3" offset="VertexBarrel_Layer3_offset+VertexBarrel_Layer3_overlap-inner_mod_rphi_sensitive/2.0" material="Silicon" vis="SiVertexSensitiveVis" nModules="VertexBarrel_Layer3_nModules" dz="VertexBarrel_mod_z_spacing" z_length="inner_mod_z"/> <!-- Inverted direction-->
                <module_envelope width="inner_mod_rphi_periphery" length="0.0*mm" type="-1" vis="SiVertexPeripheryVis"/>

                <ladder    distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Sensitive_Thickness+1.45*mm" thickness="VertexBarrel_Support_Thickness" width="inner_mod_rphi" length="VertexBarrel_z3" offset="VertexBarrel_Layer3_offset+VertexBarrel_Layer3_overlap-inner_mod_rphi/2.0"    material="CarbonFiber"  vis="CarbonFiberVis">
                    <support thickness="VertexBarrel_Support_Thickness" width="inner_mod_rphi" length="VertexBarrel_z3" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/>
                </ladder>

                <readout width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+1.45*mm" offset="VertexBarrel_Layer3_offset+VertexBarrel_Layer3_overlap-inner_mod_rphi/2" vis="SiVertexCableVis">
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+1.45*mm" offset="inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner+1.45*mm" offset="inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                    <component thickness="FlexKaptonThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+1.45*mm" offset="-inner_flex_offset" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessInner" width="inner_flex_width" length="VertexBarrel_z3" distance="VertexBarrel_r3+VertexBarrel_Layer3_offset_r+VertexBarrel_Support_Thickness+VertexBarrel_Sensitive_Thickness+FlexKaptonThicknessInner+1.45*mm" offset="-inner_flex_offset" material="Copper" vis="SiVertexCableVis"/>
                </readout>
            </layer>
        </detector>
    </detectors>

    <!-- Vertex outer barrel -->
    <detectors>
        <detector name="VertexOuterBarrel" type="VertexBarrel_IDEA_o1_v01" vis="VXDVis" id="DetID_VXD_OuterBarrel" readout="VertexOuterBarrelCollection"  region="VertexOuterBarrelRegion">
            <envelope vis="VXDVis">
                <shape type="Assembly"/>
            </envelope>
            <comment>Vertex Detector Outer Barrel</comment>
            <sensitive type="SimpleTrackerSD"/>

            <!-- Order of layers: 688 um power-bus stave flex, 50 um silicon sensor, 20 um carbon fleece grafite, 120 um carbon fiber, 25 um carbon paper-grafite, 20 um carbon fleece grafite -->
            <!-- Module width: 42.2 mm -->
            <type_flags type=" DetType_TRACKER + DetType_PIXEL + DetType_VERTEX + DetType_BARREL"/>

            <layer nLadders="VertexOuterBarrel_Staves1" phi0="0" phi_tilt="VertexOuterBarrel_tilt" id="0">
                <!-- Readout: Flex along the stave -->
                <readout width="VertexOuterBarrel_flex_width" length="VertexOuterBarrel_z1" distance="VertexOuterBarrel_r1" offset="VertexOuterBarrel_offset1" vis="SiVertexCableVis">
                    <component thickness="FlexKaptonThicknessOuter" width="VertexOuterBarrel_flex_width" length="VertexOuterBarrel_z1" distance="VertexOuterBarrel_r1" offset="0.0*mm" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessOuter" width="VertexOuterBarrel_flex_width" length="VertexOuterBarrel_z1" distance="VertexOuterBarrel_r1+FlexKaptonThicknessOuter" offset="0.0*mm" material="Copper" vis="SiVertexCableVis"/>
                </readout>

                <!-- Then the sensor, not implemented separate passive periphery -->
                <sensitive distance="VertexOuterBarrel_r1+outer_flex_thickness" thickness="VertexOuterBarrel_Sensitive_Thickness" width="VertexOuterBarrel_rphi_sensitive" length="VertexOuterBarrel_z1" offset="VertexOuterBarrel_offset1-VertexOuterBarrel_rphi_periphery/2." material="Silicon" vis="SiVertexSensitiveVis" nModules="VertexOuterBarrel_nModules1" dz="VertexOuterBarrel_mod_z_spacing" z_length="outer_mod_z"/>
                <!-- with its passive periphery -->
                <module_envelope width="VertexOuterBarrel_rphi_periphery" length="0.0*mm" type="1" vis="SiVertexPeripheryVis"/>

                <!-- Support structure -->
                <ladder distance="VertexOuterBarrel_r1+outer_flex_thickness+VertexOuterBarrel_Sensitive_Thickness" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z1" offset="VertexOuterBarrel_offset1" material="CarbonFiber" vis="CarbonFiberVis">
                    <support thickness="VertexOuterBarrel_Support_Thickness_Fleece" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z1" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->
                    <support thickness="VertexOuterBarrel_Support_Thickness_CarbonFiber" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z1" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/>
                    <support thickness="VertexOuterBarrel_Support_Thickness_PaperGraphite" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z1" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonPaperGraphite", not implemented yet! -->                    
                    <support thickness="VertexOuterBarrel_Support_Thickness_Fleece" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z1" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->                    
                </ladder>
            </layer>

            <layer nLadders="VertexOuterBarrel_Staves2" phi0="0" phi_tilt="VertexOuterBarrel_tilt" id="1">
                <!-- First comes the support structure -->
                <ladder distance="VertexOuterBarrel_r2" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z2" offset="VertexOuterBarrel_offset2"    material="CarbonFiber"  vis="CarbonFiberVis">
                    <support thickness="VertexOuterBarrel_Support_Thickness_Fleece" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z2" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->
                    <support thickness="VertexOuterBarrel_Support_Thickness_PaperGraphite" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z2" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonPaperGraphite", not implemented yet! -->
                    <support thickness="VertexOuterBarrel_Support_Thickness_CarbonFiber" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z2" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/>
                    <support thickness="VertexOuterBarrel_Support_Thickness_Fleece" width="VertexOuterBarrel_rphi" length="VertexOuterBarrel_z2" offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->
                </ladder>

                <!-- Then the sensor, not implemented separate passive periphery -->
                <sensitive distance="VertexOuterBarrel_r2+VertexOuterBarrel_Support_Thickness" thickness="VertexOuterBarrel_Sensitive_Thickness" width="VertexOuterBarrel_rphi_sensitive" length="VertexOuterBarrel_z2" offset="VertexOuterBarrel_offset2-VertexOuterBarrel_rphi_periphery/2." material="Silicon" vis="SiVertexSensitiveVis" nModules="VertexOuterBarrel_nModules2" dz="VertexOuterBarrel_mod_z_spacing" z_length="outer_mod_z"/>
                <!-- with its passive periphery -->
                <module_envelope width="VertexOuterBarrel_rphi_periphery" length="0.0*mm" type="1" vis="SiVertexPeripheryVis"/>

                <!-- Readout: Flex along the stave -->
                <readout width="VertexOuterBarrel_flex_width" length="VertexOuterBarrel_z2" distance="VertexOuterBarrel_r2+VertexOuterBarrel_Support_Thickness+VertexOuterBarrel_Sensitive_Thickness" offset="VertexOuterBarrel_offset2" vis="SiVertexCableVis">
                    <component thickness="FlexKaptonThicknessOuter" width="VertexOuterBarrel_flex_width" length="VertexOuterBarrel_z2" distance="VertexOuterBarrel_r2+VertexOuterBarrel_Support_Thickness+VertexOuterBarrel_Sensitive_Thickness" offset="0.0*mm" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessOuter" width="VertexOuterBarrel_flex_width" length="VertexOuterBarrel_z2" distance="VertexOuterBarrel_r2+VertexOuterBarrel_Support_Thickness+VertexOuterBarrel_Sensitive_Thickness+FlexKaptonThicknessOuter" offset="0.0*mm" material="Copper" vis="SiVertexCableVis"/>
                </readout>
            </layer>
        </detector>
    </detectors>
    
    <!-- Vertex endcap -->
    <detectors>
        <detector id="DetID_VXD_Endcap" name="VertexEndcap" type="VertexEndcap_IDEA_o1_v01" readout="VertexEndcapCollection" reflect="true" region="VertexEndcapRegion">
            <envelope vis="VXDVis">
                <shape type="Assembly"/>
            </envelope>
            <comment>Vertex Detector Endcaps</comment>
            <sensitive type="SimpleTrackerSD"/>

            <type_flags type=" DetType_TRACKER + DetType_PIXEL + DetType_VERTEX + DetType_ENDCAP"/>
            <module name="SiVertexEndCapModule">
                <!-- Order of layers: 688 um power-bus stave flex, 50 um silicon sensor, 20 um carbon fleece grafite, 120 um carbon fiber, 25 um carbon paper-grafite -->

                <!-- Flex at low-z -->
                <readout z_offset="0.0*mm">
                    <component thickness="FlexKaptonThicknessOuter" width="VertexEndcap_flex_width" offset="0.0*mm" z_offset="0.0*mm" material="Kapton" vis="SiVertexCableVis"/>
                    <component thickness="FlexCopperThicknessOuter" width="VertexEndcap_flex_width" offset="0.0*mm" z_offset="FlexKaptonThicknessOuter" material="Copper" vis="SiVertexCableVis"/>
                </readout>

                <!-- Sensor -->
                <sensor z_offset="outer_flex_thickness" thickness="VertexOuterBarrel_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False" xmin="-(outer_z_sensitive+outer_z_periphery+outer_z_sens_spacing/2.0)" xmax="-(outer_z_sensitive+outer_z_sens_spacing/2.0)"                ymin="-(outer_rphi_sensitive+outer_rphi_periphery+outer_rphi_sens_spacing/2.0)" ymax="outer_rphi_sensitive+outer_rphi_periphery+outer_rphi_sens_spacing/2.0"    vis="SiVertexEndcapPeripheryVis"/> <!-- top Quad periphery-->
                    <component sensitive="False" xmin="outer_z_sensitive+outer_z_sens_spacing/2.0"                      xmax="outer_z_sensitive+outer_z_periphery+outer_z_sens_spacing/2.0" ymin="-(outer_rphi_sensitive+outer_rphi_periphery+outer_rphi_sens_spacing/2.0)" ymax="outer_rphi_sensitive+outer_rphi_periphery+outer_rphi_sens_spacing/2.0"    vis="SiVertexEndcapPeripheryVis"/> <!-- bottom Quad periphery-->   
                    <component sensitive="False" xmin="-(outer_z_sensitive+outer_z_sens_spacing/2.0)"                   xmax="outer_z_sensitive+outer_z_sens_spacing/2.0"                   ymin="-(outer_rphi_sensitive+outer_rphi_periphery+outer_rphi_sens_spacing/2.0)" ymax="-(outer_rphi_sensitive+outer_rphi_sens_spacing/2.0)"                      vis="SiVertexEndcapPeripheryVis"/> <!-- left Quad periphery-->   
                    <component sensitive="False" xmin="-(outer_z_sensitive+outer_z_sens_spacing/2.0)"                   xmax="outer_z_sensitive+outer_z_sens_spacing/2.0"                   ymin="outer_rphi_sensitive+outer_rphi_sens_spacing/2.0"                         ymax="outer_rphi_sensitive+outer_rphi_periphery+outer_rphi_sens_spacing/2.0"    vis="SiVertexEndcapPeripheryVis"/> <!-- right Quad periphery-->   

                    <component sensitive="False" xmin="outer_z_sens_spacing/2.0"                        xmax="outer_z_sensitive+outer_z_sens_spacing/2.0"   ymin="-outer_rphi_sens_spacing/2.0"                         ymax="outer_rphi_sens_spacing/2.0"                          vis="SiVertexEndcapPeripheryVis"/> <!-- Middle cross: right -->
                    <component sensitive="False" xmin="-(outer_z_sensitive+outer_z_sens_spacing/2.0)"   xmax="-outer_z_sens_spacing/2.0"                    ymin="-outer_rphi_sens_spacing/2.0"                         ymax="outer_rphi_sens_spacing/2.0"                          vis="SiVertexEndcapPeripheryVis"/> <!-- Middle cross: left -->
                    <component sensitive="False" xmin="-outer_z_sens_spacing/2.0"                       xmax="outer_z_sens_spacing/2.0"                     ymin="outer_rphi_sens_spacing/2.0"                          ymax="outer_rphi_sens_spacing/2.0+outer_rphi_sensitive"     vis="SiVertexEndcapPeripheryVis"/> <!-- Middle cross: top -->
                    <component sensitive="False" xmin="-outer_z_sens_spacing/2.0"                       xmax="outer_z_sens_spacing/2.0"                     ymin="-(outer_rphi_sens_spacing/2.0+outer_rphi_sensitive)"  ymax="-outer_rphi_sens_spacing/2.0"                         vis="SiVertexEndcapPeripheryVis"/> <!-- Middle cross: bottom -->
                    <component sensitive="False" xmin="-outer_z_sens_spacing/2.0"                       xmax="outer_z_sens_spacing/2.0"                     ymin="-outer_rphi_sens_spacing/2.0"                         ymax="outer_rphi_sens_spacing/2.0"                          vis="SiVertexEndcapPeripheryVis"/> <!-- Middle cross: centre -->
                    
                    <component sensitive="True" xmin="-outer_z_sensitive-outer_z_sens_spacing/2.0"  xmax="-outer_z_sens_spacing/2.0"                    ymin="outer_rphi_sens_spacing/2.0"                          ymax="outer_rphi_sens_spacing/2.0+outer_rphi_sensitive" vis="SiVertexEndcapSensitiveVis"/> <!-- top left sensitive-->
                    <component sensitive="True" xmin="outer_z_sens_spacing/2.0"                     xmax="outer_z_sensitive+outer_z_sens_spacing/2.0"   ymin="outer_rphi_sens_spacing/2.0"                          ymax="outer_rphi_sens_spacing/2.0+outer_rphi_sensitive" vis="SiVertexEndcapSensitiveVis"/> <!-- top right sensitive-->                    
                    <component sensitive="True" xmin="-outer_z_sensitive-outer_z_sens_spacing/2.0"  xmax="-outer_z_sens_spacing/2.0"                    ymin="-outer_rphi_sens_spacing/2.0-outer_rphi_sensitive"    ymax="-outer_rphi_sens_spacing/2.0"                     vis="SiVertexEndcapSensitiveVis"/> <!-- bottom left sensitive-->                    
                    <component sensitive="True" xmin="outer_z_sens_spacing/2.0"                     xmax="outer_z_sensitive+outer_z_sens_spacing/2.0"   ymin="-outer_rphi_sens_spacing/2.0-outer_rphi_sensitive"    ymax="-outer_rphi_sens_spacing/2.0"                     vis="SiVertexEndcapSensitiveVis"/> <!-- bottom right sensitive--> 
                </sensor>

                <!-- low-z support -->
                <support z_offset="outer_flex_thickness+VertexOuterBarrel_Sensitive_Thickness">
                    <component thickness="VertexOuterBarrel_Support_Thickness_Fleece" width="outer_mod_z" offset="0.0*mm" z_offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->
                    <component thickness="VertexOuterBarrel_Support_Thickness_CarbonFiber" width="outer_mod_z" offset="0.0*mm" z_offset="VertexOuterBarrel_Support_Thickness_Fleece" material="CarbonFiber" vis="CarbonFiberVis"/>
                    <component thickness="VertexOuterBarrel_Support_Thickness_PaperGraphite" width="outer_mod_z" offset="0.0*mm" z_offset="VertexOuterBarrel_Support_Thickness_Fleece+VertexOuterBarrel_Support_Thickness_CarbonFiber" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonPaperGraphite", not implemented yet! -->
                </support>

                <!-- high-z support -->
                <support z_offset="outer_flex_thickness+VertexOuterBarrel_Sensitive_Thickness+VertexEndcap_stave_dz">
                    <component thickness="VertexOuterBarrel_Support_Thickness_PaperGraphite" width="outer_mod_z" offset="0.0*mm" z_offset="0.0*mm" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonPaperGraphite", not implemented yet! -->
                    <component thickness="VertexOuterBarrel_Support_Thickness_CarbonFiber" width="outer_mod_z" offset="0.0*mm" z_offset="VertexOuterBarrel_Support_Thickness_PaperGraphite" material="CarbonFiber" vis="CarbonFiberVis"/>
                    <component thickness="VertexOuterBarrel_Support_Thickness_Fleece" width="outer_mod_z" offset="0.0*mm" z_offset="VertexOuterBarrel_Support_Thickness_PaperGraphite+VertexOuterBarrel_Support_Thickness_CarbonFiber" material="CarbonFiber" vis="CarbonFiberVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->
                </support>

                <!-- Flex at high-z -->
                <readout z_offset="outer_flex_thickness+2.0*(VertexOuterBarrel_Sensitive_Thickness+VertexEndcap_Support_Thickness)+VertexEndcap_stave_dz">
                    <component thickness="FlexCopperThicknessOuter" width="VertexEndcap_flex_width" offset="0.0*mm" z_offset="0.0*mm" material="Copper" vis="SiVertexCableVis"/>
                    <component thickness="FlexKaptonThicknessOuter" width="VertexEndcap_flex_width" offset="0.0*mm" z_offset="FlexCopperThicknessOuter" material="Kapton" vis="SiVertexCableVis"/>
                </readout>
            </module>

            <layer id="0" z="VertexEndcap_z1" nphi="4" dz="0.0*mm" rmin="VertexEndcap_rmin1" dr="VertexEndcap_dr1" phi0="0.0">
                <stave nmodules="2" z_offset="0.0*mm" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="0.0*mm" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="3" z_offset="VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="1.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="4" z_offset="0.0*mm" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="2.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="4" z_offset="VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="3.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="5" z_offset="0.0*mm" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="4.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="6" z_offset="VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="5.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>

                <stave nmodules="2" z_offset="VertexEndcap_zoffset_face" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="0.0*mm" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1B" module="SiVertexEndCapModule"/>
                <stave nmodules="3" z_offset="VertexEndcap_zoffset_face+VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="1.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1B" module="SiVertexEndCapModule"/>
                <stave nmodules="4" z_offset="VertexEndcap_zoffset_face" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="2.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1B" module="SiVertexEndCapModule"/>
                <stave nmodules="5" z_offset="VertexEndcap_zoffset_face+VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="3.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1B" module="SiVertexEndCapModule"/>
                <stave nmodules="5" z_offset="VertexEndcap_zoffset_face" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="4.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1B" module="SiVertexEndCapModule"/>
                <stave nmodules="6" z_offset="VertexEndcap_zoffset_face+VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="5.*(outer_mod_z+VertexEndcap_rModOverlap)" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1B" module="SiVertexEndCapModule"/>
            </layer>

            <layer id="1" z="VertexEndcap_z2" nphi="8" dz="VertexEndcap_zoffset_face" rmin="VertexEndcap_rmin2" dr="VertexEndcap_dr2" phi0="0.0">
                <stave nmodules="3" z_offset="0.0*mm" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="0.0*mm" dr="VertexEndcap_dr2" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="4" z_offset="VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="1.*(outer_mod_z+VertexEndcap_rModOverlap)" dr="VertexEndcap_dr2" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="5" z_offset="0.0*mm" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="2.*(outer_mod_z+VertexEndcap_rModOverlap)" dr="VertexEndcap_dr2" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="6" z_offset="VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="3.*(outer_mod_z+VertexEndcap_rModOverlap)" dr="VertexEndcap_dr2" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="7" z_offset="0.0*mm" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="4.*(outer_mod_z+VertexEndcap_rModOverlap)" dr="VertexEndcap_dr2" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="8" z_offset="VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="5.*(outer_mod_z+VertexEndcap_rModOverlap)" dr="VertexEndcap_dr2" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
            </layer>        

            <layer id="2" z="VertexEndcap_z3" nphi="8" dz="VertexEndcap_zoffset_face" rmin="VertexEndcap_rmin3" dr="VertexEndcap_dr3" phi0="0.0">
                <stave nmodules="4" z_offset="0.0*mm" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="0.0*mm" dr="VertexEndcap_dr3" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="5" z_offset="VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="1.*(outer_mod_z+VertexEndcap_rModOverlap)" dr="VertexEndcap_dr3" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="5" z_offset="0.0*mm" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="2.*(outer_mod_z+VertexEndcap_rModOverlap)" dr="VertexEndcap_dr3" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="6" z_offset="VertexEndcap_zoffset_stave" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="3.*(outer_mod_z+VertexEndcap_rModOverlap)" dr="VertexEndcap_dr3" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
                <stave nmodules="7" z_offset="0.0*mm" dz="VertexEndcap_Support_Thickness+VertexEndcap_stave_dz+VertexEndcap_Support_Thickness" r="4.*(outer_mod_z+VertexEndcap_rModOverlap)" dr="VertexEndcap_dr3" step="VertexEndcapModOverlap" phi0="VertexEndcap_phi1A" module="SiVertexEndCapModule"/>
            </layer>   



        </detector>
    </detectors>
<!--        
        <detector>
            <detector name="VertexVerticalCable" type="TrackerEndcapSupport_o1_v01" reflect="true"  region="VertexEndcapRegion">
	        <envelope>
		        <shape type="Assembly"/>
    	    </envelope>
	        <layer id="1" inner_r="VertexBarrel_r1" inner_z="VertexBarrel_zmax+1*mm" outer_r="Vertex_outer_radius-5*env_safety" vis="SiVertexCableVis">
		        <slice material="Copper" thickness="0.02*mm" />
    	    </layer>
        </detector>
-->

    <!-- also needed for barrel? -->
    <plugins>
        <plugin name="DD4hep_GenericSurfaceInstallerPlugin">
            <argument value="VertexEndcap"/> 
            <argument value="dimension=2"/>
            <argument value="u_x=-1."/>
            <argument value="v_y=1."/>
            <argument value="n_z=-1."/>
        </plugin>
    </plugins>

  <!-- vertex barrel support structure --> 
	<!-- If you supply materials and visualisation attributes to the shape:
	     1) The material attribute in the <shape/> element will be applied 
	        to all sub-volumes without an explicit material attribute in the 
   	        <volume/> element.
	     2) dto. the material cchild in the <shape/> element.
	     3) The material attribute in the <volume/> element applies 
	        ONLY to the volume specified. This allows to specify a separate 
                material for each sub-volume in multi-volume CADs.
             4) The vis attribute in the  <volume/> element applies 
	        ONLY to the volume specified. The name identifies a dd4hep vis object.
        -->
    <detectors>
        <detector id="7" name="Shape_STL" type="DD4hep_TestShape_Creator">
            <check>
                <shape type="CAD_Assembly"
                    ref="VertexSupport_o1_v01.stl"
                    unit="mm">
                <volume id="0" name="s1" vis="CarbonFiberVis" material="CarbonFiber"/>
                </shape>
                <position x="0*cm" y="0*cm" z="0*cm"/>
                <rotation x="0" y="pi/2*rad"  z="0"/>
            </check>
        </detector>
    </detectors>

</lccdd>
